run() {
    make -j $(nproc) "aoc-${UMBRA_DEVENV_ENVIRONMENT}"
    "./bin/aoc-${UMBRA_DEVENV_ENVIRONMENT}" $@
}

tests() {
    make -j $(nproc) "tests-${UMBRA_DEVENV_ENVIRONMENT}"
    "./bin/tests-${UMBRA_DEVENV_ENVIRONMENT}" $@
}

debug() {
    make -j $(nproc) "tests-${UMBRA_DEVENV_ENVIRONMENT}"
    gdb "./bin/tests-${UMBRA_DEVENV_ENVIRONMENT}" 
}

callgrind() {
    if [[ "$1" != "" && "$1" != "tests" ]]; 
    then
        echo "Usage:"
        echo 
        echo "Run main binary"
        echo "  callgrind"
        echo "Run test binary"
        echo "  callgrind tests"
        exit -2
    fi

    make -j $(nproc) "${1:-aoc}-${UMBRA_DEVENV_ENVIRONMENT}"
    valgrind --tool=callgrind --callgrind-out-file=callgrind-out -- "./bin/${1:-aoc}-${UMBRA_DEVENV_ENVIRONMENT}" $@
    callgrind_annotate callgrind-out | less
}
profile() {
    if [[ "$1" != "" && "$1" != "tests" ]];
    then
        echo "Usage:"
        echo 
        echo "Run main binary"
        echo "  profile"
        echo "Run test binary"
        echo "  profile tests"
        exit -2
    fi

    make -j $(nproc) "${1:-aoc}-${UMBRA_DEVENV_ENVIRONMENT}"
    perf -- "./bin/${1:-aoc}-${UMBRA_DEVENV_ENVIRONMENT}" $@
}

createday() {
    day=$1
    year=${2:-$UMBRA_DEVENV_ENVIRONMENT}
    if [[ "$day" == "" ]]; then
        echo "Which day?"
        exit -2
    fi
    if [[ "$year" == "" ]]; then
        echo "Which year?"
        exit -2
    fi

    git_root=$(git rev-parse --show-toplevel)

    cat "${git_root}/_template/src/aoc/days/Day1.cpp" \
        | sed "s/2019/$year/g" \
        | sed "s/Day1/Day$day/g" \
        | tee "${git_root}/y$year/src/aoc/days/Day$day.cpp"
    cat "${git_root}/_template/src/aoc/days/Day1.hpp" \
        | sed "s/DECLARE_DAY(2019, 1)/DECLARE_DAY($year, $day)/" \
        | sed "s/2019/$year/g" \
        | sed "s/Day1/Day$day/g" \
        | tee "${git_root}/y$year/src/aoc/days/Day$day.hpp"
}

helpme() {
    echo "Commands: run, tests, debug, callgrind, profile"
}

# vim:ft=bash
